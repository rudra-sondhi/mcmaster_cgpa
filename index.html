<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>McMaster GPA Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
            font-size: 0.9em;
            font-weight: 600;
        }

        .save-indicator.show {
            opacity: 1;
        }

        .content {
            padding: 30px;
        }

        .table-container {
            overflow-x: auto;
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        thead {
            background: #f8f9fa;
        }

        th {
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
        }

        td {
            padding: 12px 10px;
            border-bottom: 1px solid #dee2e6;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .grade-input-group {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .grade-input-group select,
        .grade-input-group input {
            flex: 1;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .stats-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-top: 30px;
        }

        .stats-container h2 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.9em;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .stat-value {
            color: #667eea;
            font-size: 2em;
            font-weight: bold;
        }

        .grade-distribution {
            margin-top: 25px;
        }

        .grade-distribution h3 {
            color: #495057;
            margin-bottom: 15px;
        }

        .distribution-bar {
            margin-bottom: 12px;
        }

        .distribution-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9em;
            color: #495057;
        }

        .bar-container {
            background: #e9ecef;
            border-radius: 10px;
            height: 25px;
            overflow: hidden;
        }

        .bar-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-size: 0.8em;
            font-weight: 600;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .empty-state p {
            font-size: 1.1em;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 15px;
            }

            th, td {
                padding: 8px 5px;
                font-size: 13px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="save-indicator" id="saveIndicator">üíæ Saved!</div>
    <div class="container">
        <div class="header">
            <h1>üìö McMaster GPA Calculator</h1>
            <p>Track your academic performance across all grading scales</p>
        </div>

        <div class="content">
            <div class="button-group">
                <button class="btn btn-primary" onclick="addRow()">‚ûï Add Course</button>
                <button class="btn btn-primary" onclick="clearAll()">üóëÔ∏è Clear All</button>
            </div>

            <div class="table-container">
                <table id="courseTable">
                    <thead>
                        <tr>
                            <th>Course Name</th>
                            <th>Year</th>
                            <th>Semester</th>
                            <th>Grade Type</th>
                            <th>Grade</th>
                            <th>McMaster (12)</th>
                            <th>GPA (4.0)</th>
                            <th>Percentage</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="courseTableBody">
                    </tbody>
                </table>
            </div>

            <div class="stats-container" id="statsContainer" style="display: none;">
                <h2>üìä Academic Statistics</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Courses</div>
                        <div class="stat-value" id="totalCourses">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Cumulative GPA (McMaster)</div>
                        <div class="stat-value" id="cgpaMcmaster">0.00</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Cumulative GPA (4.0 Scale)</div>
                        <div class="stat-value" id="cgpa4">0.00</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Average Percentage</div>
                        <div class="stat-value" id="avgPercentage">0%</div>
                    </div>
                </div>

                <div class="grade-distribution">
                    <h3>Grade Distribution</h3>
                    <div id="distributionBars"></div>
                </div>
            </div>

            <div class="empty-state" id="emptyState">
                <p>üëÜ Click "Add Course" to start tracking your grades</p>
            </div>
        </div>
    </div>

    <script>
        const gradeData = {
            "A+": { mcmaster_scale: 12, equivalent_percentage: 95, gpa_4_scale: 4.0 },
            "A": { mcmaster_scale: 11, equivalent_percentage: 87, gpa_4_scale: 3.9 },
            "A-": { mcmaster_scale: 10, equivalent_percentage: 82, gpa_4_scale: 3.7 },
            "B+": { mcmaster_scale: 9, equivalent_percentage: 78, gpa_4_scale: 3.3 },
            "B": { mcmaster_scale: 8, equivalent_percentage: 74.5, gpa_4_scale: 3.0 },
            "B-": { mcmaster_scale: 7, equivalent_percentage: 71, gpa_4_scale: 2.7 },
            "C+": { mcmaster_scale: 6, equivalent_percentage: 68, gpa_4_scale: 2.3 },
            "C": { mcmaster_scale: 5, equivalent_percentage: 64.5, gpa_4_scale: 2.0 },
            "C-": { mcmaster_scale: 4, equivalent_percentage: 61, gpa_4_scale: 1.7 },
            "D+": { mcmaster_scale: 3, equivalent_percentage: 58, gpa_4_scale: 1.3 },
            "D": { mcmaster_scale: 2, equivalent_percentage: 54.5, gpa_4_scale: 1.0 },
            "D-": { mcmaster_scale: 1, equivalent_percentage: 51, gpa_4_scale: 0.7 },
            "F": { mcmaster_scale: 0, equivalent_percentage: 24.5, gpa_4_scale: 0.0 }
        };

        let rowCounter = 0;

        // Load data from localStorage on page load
        function loadData() {
            const savedData = localStorage.getItem('gpaCalculatorData');
            if (savedData) {
                try {
                    const courses = JSON.parse(savedData);
                    courses.forEach(course => {
                        addRow(course);
                    });
                } catch (e) {
                    console.error('Error loading saved data:', e);
                }
            } else {
                // Add one empty row if no saved data
                addRow();
            }
        }

        // Save data to localStorage
        function saveData() {
            const tbody = document.getElementById('courseTableBody');
            const rows = tbody.getElementsByTagName('tr');
            const courses = [];

            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const rowId = row.id;
                
                const courseName = row.cells[0].querySelector('input').value;
                const year = row.cells[1].querySelector('input').value;
                const semester = row.cells[2].querySelector('input').value;
                const gradeType = row.cells[3].querySelector('select').value;
                
                let gradeValue = '';
                const gradeInputCell = document.getElementById(`gradeInput-${rowId}`);
                if (gradeInputCell) {
                    const select = gradeInputCell.querySelector('select');
                    const input = gradeInputCell.querySelector('input');
                    if (select) {
                        gradeValue = select.value;
                    } else if (input && !input.disabled) {
                        gradeValue = input.value;
                    }
                }

                const mcmaster = row.cells[5].querySelector('input').value;
                const gpa4 = row.cells[6].querySelector('input').value;
                const percentage = row.cells[7].querySelector('input').value;

                courses.push({
                    courseName,
                    year,
                    semester,
                    gradeType,
                    gradeValue,
                    mcmaster,
                    gpa4,
                    percentage
                });
            }

            localStorage.setItem('gpaCalculatorData', JSON.stringify(courses));
            showSaveIndicator();
        }

        // Show save indicator animation
        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 1500);
        }

        function findClosestGrade(value, type) {
            let closestGrade = null;
            let minDiff = Infinity;

            for (const [grade, data] of Object.entries(gradeData)) {
                let diff;
                if (type === 'mcmaster') {
                    diff = Math.abs(data.mcmaster_scale - value);
                } else if (type === '4.0') {
                    diff = Math.abs(data.gpa_4_scale - value);
                } else if (type === 'percentage') {
                    diff = Math.abs(data.equivalent_percentage - value);
                }

                if (diff < minDiff) {
                    minDiff = diff;
                    closestGrade = grade;
                }
            }

            return closestGrade;
        }

        function addRow(courseData = null) {
            const tbody = document.getElementById('courseTableBody');
            const row = tbody.insertRow();
            const rowId = `row-${rowCounter++}`;
            row.id = rowId;

            row.innerHTML = `
                <td><input type="text" placeholder="e.g., COMPSCI 2C03" oninput="saveData()"></td>
                <td><input type="text" placeholder="e.g., 2024" oninput="saveData()"></td>
                <td><input type="text" placeholder="e.g., Fall" oninput="saveData()"></td>
                <td>
                    <select onchange="handleGradeTypeChange('${rowId}')">
                        <option value="">Select Type</option>
                        <option value="letter">Letter Grade</option>
                        <option value="mcmaster">McMaster (0-12)</option>
                        <option value="4.0">4.0 Scale</option>
                        <option value="percentage">Percentage</option>
                    </select>
                </td>
                <td id="gradeInput-${rowId}">
                    <input type="text" disabled placeholder="Select grade type first">
                </td>
                <td><input type="text" id="mcmaster-${rowId}" readonly></td>
                <td><input type="text" id="gpa4-${rowId}" readonly></td>
                <td><input type="text" id="percentage-${rowId}" readonly></td>
                <td>
                    <button class="btn btn-danger" onclick="deleteRow('${rowId}')">‚úï</button>
                </td>
            `;

            // If courseData is provided, populate the row
            if (courseData) {
                row.cells[0].querySelector('input').value = courseData.courseName || '';
                row.cells[1].querySelector('input').value = courseData.year || '';
                row.cells[2].querySelector('input').value = courseData.semester || '';
                
                if (courseData.gradeType) {
                    row.cells[3].querySelector('select').value = courseData.gradeType;
                    handleGradeTypeChange(rowId);
                    
                    // Set the grade value after a brief delay to ensure the input is created
                    setTimeout(() => {
                        const gradeInputCell = document.getElementById(`gradeInput-${rowId}`);
                        if (gradeInputCell && courseData.gradeValue) {
                            const select = gradeInputCell.querySelector('select');
                            const input = gradeInputCell.querySelector('input');
                            
                            if (select) {
                                select.value = courseData.gradeValue;
                                handleGradeInput(rowId, 'letter');
                            } else if (input) {
                                input.value = courseData.gradeValue;
                                handleGradeInput(rowId, courseData.gradeType);
                            }
                        }
                    }, 0);
                }
            }

            updateStats();
        }

        function handleGradeTypeChange(rowId) {
            const row = document.getElementById(rowId);
            const gradeType = row.querySelector('select').value;
            const gradeInputCell = document.getElementById(`gradeInput-${rowId}`);

            if (!gradeType) {
                gradeInputCell.innerHTML = '<input type="text" disabled placeholder="Select grade type first">';
                saveData();
                return;
            }

            if (gradeType === 'letter') {
                gradeInputCell.innerHTML = `
                    <select onchange="handleGradeInput('${rowId}', 'letter')">
                        <option value="">Select Grade</option>
                        ${Object.keys(gradeData).map(grade => 
                            `<option value="${grade}">${grade}</option>`
                        ).join('')}
                    </select>
                `;
            } else if (gradeType === 'mcmaster') {
                gradeInputCell.innerHTML = `
                    <input type="number" min="0" max="12" step="1" 
                           placeholder="0-12" 
                           onchange="handleGradeInput('${rowId}', 'mcmaster')">
                `;
            } else if (gradeType === '4.0') {
                gradeInputCell.innerHTML = `
                    <input type="number" min="0" max="4.0" step="0.1" 
                           placeholder="0.0-4.0" 
                           onchange="handleGradeInput('${rowId}', '4.0')">
                `;
            } else if (gradeType === 'percentage') {
                gradeInputCell.innerHTML = `
                    <input type="number" min="0" max="100" step="0.1" 
                           placeholder="0-100" 
                           onchange="handleGradeInput('${rowId}', 'percentage')">
                `;
            }
            
            saveData();
        }

        function handleGradeInput(rowId, inputType) {
            const row = document.getElementById(rowId);
            const gradeInputCell = document.getElementById(`gradeInput-${rowId}`);
            let value, letterGrade;

            if (inputType === 'letter') {
                letterGrade = gradeInputCell.querySelector('select').value;
                if (!letterGrade || !gradeData[letterGrade]) return;
            } else {
                value = parseFloat(gradeInputCell.querySelector('input').value);
                if (isNaN(value)) return;
                
                letterGrade = findClosestGrade(value, inputType);
            }

            const data = gradeData[letterGrade];
            
            document.getElementById(`mcmaster-${rowId}`).value = data.mcmaster_scale;
            document.getElementById(`gpa4-${rowId}`).value = data.gpa_4_scale.toFixed(1);
            document.getElementById(`percentage-${rowId}`).value = data.equivalent_percentage + '%';

            updateStats();
            saveData();
        }

        function deleteRow(rowId) {
            const row = document.getElementById(rowId);
            row.remove();
            updateStats();
            saveData();
        }

        function clearAll() {
            if (confirm('Are you sure you want to clear all courses?')) {
                document.getElementById('courseTableBody').innerHTML = '';
                localStorage.removeItem('gpaCalculatorData');
                updateStats();
                addRow(); // Add one empty row after clearing
            }
        }

        function updateStats() {
            const tbody = document.getElementById('courseTableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            if (rows.length === 0) {
                document.getElementById('statsContainer').style.display = 'none';
                document.getElementById('emptyState').style.display = 'block';
                return;
            }

            document.getElementById('statsContainer').style.display = 'block';
            document.getElementById('emptyState').style.display = 'none';

            let totalMcmaster = 0;
            let totalGpa4 = 0;
            let totalPercentage = 0;
            let validCourses = 0;
            const gradeCount = {};

            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const mcmasterVal = parseFloat(row.cells[5].querySelector('input').value);
                const gpa4Val = parseFloat(row.cells[6].querySelector('input').value);
                const percentageVal = parseFloat(row.cells[7].querySelector('input').value);

                if (!isNaN(mcmasterVal) && !isNaN(gpa4Val) && !isNaN(percentageVal)) {
                    totalMcmaster += mcmasterVal;
                    totalGpa4 += gpa4Val;
                    totalPercentage += percentageVal;
                    validCourses++;

                    // Find the letter grade for distribution
                    for (const [grade, data] of Object.entries(gradeData)) {
                        if (data.mcmaster_scale === mcmasterVal) {
                            gradeCount[grade] = (gradeCount[grade] || 0) + 1;
                            break;
                        }
                    }
                }
            }

            document.getElementById('totalCourses').textContent = validCourses;
            document.getElementById('cgpaMcmaster').textContent = 
                validCourses > 0 ? (totalMcmaster / validCourses).toFixed(2) : '0.00';
            document.getElementById('cgpa4').textContent = 
                validCourses > 0 ? (totalGpa4 / validCourses).toFixed(2) : '0.00';
            document.getElementById('avgPercentage').textContent = 
                validCourses > 0 ? (totalPercentage / validCourses).toFixed(1) + '%' : '0%';

            // Update grade distribution
            updateDistribution(gradeCount, validCourses);
        }

        function updateDistribution(gradeCount, totalCourses) {
            const distributionBars = document.getElementById('distributionBars');
            distributionBars.innerHTML = '';

            if (totalCourses === 0) return;

            const sortedGrades = Object.entries(gradeCount)
                .sort((a, b) => gradeData[b[0]].mcmaster_scale - gradeData[a[0]].mcmaster_scale);

            sortedGrades.forEach(([grade, count]) => {
                const percentage = ((count / totalCourses) * 100).toFixed(1);
                const bar = document.createElement('div');
                bar.className = 'distribution-bar';
                bar.innerHTML = `
                    <div class="distribution-label">
                        <span>${grade}</span>
                        <span>${count} course${count !== 1 ? 's' : ''}</span>
                    </div>
                    <div class="bar-container">
                        <div class="bar-fill" style="width: ${percentage}%">
                            ${percentage}%
                        </div>
                    </div>
                `;
                distributionBars.appendChild(bar);
            });
        }

        // Load saved data on page load
        window.onload = function() {
            loadData();
        };
    </script>
</body>
</html>
